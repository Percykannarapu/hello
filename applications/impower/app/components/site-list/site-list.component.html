<div class="ui-g ui-g-nopad">
  <div class="ui-g-5">
    <label>Manage for:</label>
    &nbsp;
    <p-radioButton name="siteListSiteGroup" value="Site" label="Sites" [(ngModel)]="selectedListType" (ngModelChange)="onListTypeChange($event)"></p-radioButton>
    &nbsp;
    <p-radioButton name="siteListSiteGroup" value="Competitor" label="Competitors" [(ngModel)]="selectedListType" (ngModelChange)="onListTypeChange($event)"></p-radioButton>
  </div>
  <div class="ui-g-7">
    <button pButton type="button" label="Calc Home Geocodes" (click)="calcHomeGeocode()"></button>
    &nbsp;&nbsp;
    <button pButton type="button" label="HGC Issues Log" (click)="onHGCIssuesLog()" [disabled] ="selectedListType === 'Competitor'"></button>
    &nbsp;&nbsp;
    <button pButton type="button" label="Delete All" (click)="onDelete()"></button>
  </div>


  <div id="locGrid" class="ui-g-12">
    <p-table #locGrid
             [columns]="flatSiteGridColumns"
             [value]="flatAllSites$ | async"
             [selection]="flatActiveSites$ | async"
             [resizableColumns]="true" columnResizeMode="expand"
             [reorderableColumns]="true"
             sortMode="multiple"
             [responsive]="true"
             [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5,10,25,50,100,200,500,1000]"
             [alwaysShowPaginator]="false"
             [first]="first"
             (onRowUnselect)="onRowSelect($event, false)"
             (onRowSelect)="onRowSelect($event, true)"
             (onFilter)="onFilter($event)">

      <ng-template pTemplate="caption">
        <div class="ui-g ui-g-nopad">
          <div class="ui-g-4 ui-g-nopad grid-caption-left-group">
            <div class="ui-inputgroup">
              <span class="ui-inputgroup-addon"><i class="fa fa-search"></i></span>
              <span class="md-inputfield">
                <input id="locationSearch" type="text" pInputText size="30" (input)="locGrid.filterGlobal($event.target.value, 'contains')">
                <label for="locationSearch">Filter Locations</label>
              </span>
            </div>
          </div>
          <div class="ui-g-4 ui-g-nopad grid-caption-center-group">
            <label pTooltip="Selected {{activeSiteCount$ | async}} / {{allSiteCount$ | async}} sites" tooltipPosition="top">Site List</label>
          </div>
          <div class="ui-g=4 ui-g-nopad grid-caption-right-group">
            <div>
              <p-multiSelect defaultLabel="Choose Columns" [options]="columnOptions" [(ngModel)]="selectedColumns"></p-multiSelect>
            </div>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="colgroup" let-columns>
        <colgroup>
          <col style="width: 4em">
          <col style="width: 4em">
          <col style="width: 4em">
          <col *ngFor="let col of selectedColumns" [style.width]="col.width">
        </colgroup>
      </ng-template>

      <ng-template pTemplate="header" class="ui-g ui-g-nopad">
        <tr>
          <!-- <th style="width: 30px"><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th> -->
          <th style="width: 4em">Edit</th>
          <th style="width: 4em">Zoom</th>
          <th style="width: 4em">Delete</th>
          <th *ngFor="let col of selectedColumns" pResizableColumn pReorderableColumn [pSortableColumn]="col.field">
            {{col.header}}
            <p-sortIcon [field]="col.field"></p-sortIcon>
          </th>
        </tr>
        <tr class="second-header">
          <th style="width: 4em"></th>
          <th style="width: 4em"></th>
          <th style="width: 4em"></th>
          <th *ngFor="let col of selectedColumns" [ngSwitch]="col.field" style="overflow: visible">
            <input *ngSwitchCase="'locationNumber'"     pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'locationName'"       pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'locAddress'"         pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'locZip'"             pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'totalHHC'"           pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'totalAllocatedHHC'"  pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'description'"        pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'groupName'"          pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'radius1'"            pInputText type="number" (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'radius2'"            pInputText type="number" (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'radius3'"            pInputText type="number" (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'Home Geocode Issue'" pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'Home Zip Code'"      pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'Home ATZ'"           pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'Home Digital ATZ'"   pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'Home Carrier Route'" pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'origAddress1'"       pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">
            <input *ngSwitchCase="'origPostalCode'"     pInputText type="text"   (input)="locGrid.filter($event.target.value, col.field, col.filterMatchMode)" [value]="(locGrid.filters != null && locGrid.filters[col.field]) ? locGrid.filters[col.field].value : ''">

            <p-multiSelect *ngSwitchCase="'locState'"             appendTo="body" [options]="uniqueState$ | async"          defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>
            <p-multiSelect *ngSwitchCase="'locCity'"              appendTo="body" [options]="uniqueCity$ | async"           defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>
            <p-multiSelect *ngSwitchCase="'marketName'"           appendTo="body" [options]="uniqueMarket$ | async"         defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>
            <p-multiSelect *ngSwitchCase="'marketCode'"           appendTo="body" [options]="uniqueMarketCode$ | async"     defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>
            <p-multiSelect *ngSwitchCase="'recordStatusCode'"     appendTo="body" [options]="uniqueRecStatuses$ | async"    defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>
            <p-multiSelect *ngSwitchCase="'geocoderMatchCode'"    appendTo="body" [options]="uniqueMatchCodes$ | async"     defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>
            <p-multiSelect *ngSwitchCase="'geocoderLocationCode'" appendTo="body" [options]="uniqueMatchQualities$ | async" defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>
            <p-multiSelect *ngSwitchCase="'origState'"            appendTo="body" [options]="uniqueOrigState$ | async"      defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>
            <p-multiSelect *ngSwitchCase="'origCity'"             appendTo="body" [options]="uniqueOrigCity$ | async"       defaultLabel="All" [ngStyle]="{'width':'100%'}" (onChange)="locGrid.filter($event.value, col.field, 'in'); onFilter();"></p-multiSelect>

            <input *ngSwitchDefault pInputText type="text" (input)="locGrid.filter($event.target.value, col.field, 'contains')">
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-flatLoc let-columns="selectedColumns">
        <tr [pSelectableRow]="flatLoc">
          <!-- <td>
             <p-tableCheckbox [value]="flatLoc" selectionMode="multiple" [ngStyle]="{'width':'30px'}" [resizable]="false"></p-tableCheckbox>
          </td> -->
          <td style="width: 4em">
            <button type="button" pButton (click)="onEdit(flatLoc.loc)" icon="fa fa-pencil-square-o" style="margin: auto; display: block; width:25px;height:25px"></button>
          </td>
          <td style="width: 4em">
            <button (click)="onRowZoom(flatLoc.loc)" icon="ui-icon-zoom-in" pButton style="margin: auto; display: block; width:25px;height:25px"></button>
          </td>
          <td style="width: 4em">
            <button type="button" pButton (click)="onRowDelete(flatLoc.loc)" icon="ui-icon-trash" style="margin: auto; display: block; width:25px;height:25px"></button>
          </td>

          <td *ngFor="let col of selectedColumns" class="ui-resizable-column" [class]="col.styleClass" [ngSwitch]="col.field">

            <!-- Format various columns -->
            <div *ngSwitchCase = "'totalHHC'">                {{flatLoc['totalHHC'] | number:'1.0-0'}} </div>
            <div *ngSwitchCase = "'totalAllocatedHHC'">       {{flatLoc['totalAllocatedHHC'] | number:'1.0-0'}} </div>

            <!-- Display all other columns -->
            <div *ngSwitchDefault>
              {{flatLoc[col.field]}}
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage" let-columns>
        <tr class="empty-grid">
          <td style="width: 4em">&nbsp;</td>
          <td style="width: 4em">&nbsp;</td>
          <td style="width: 4em">&nbsp;</td>
          <td [attr.colspan]="columns.length">
            <div class="ui-g-12">
              <h4>No locations added.  Use the "Add Locations" tab above.</h4>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <val-failed-geocode-grid *ngIf="hasFailures$ | async"
                             [failedSites]="failures$ | async"
                             [totalCount]="totalCount$ | async"
                             [type]="'edit'"
                             (remove)="remove($event)"
                             (resubmit)="reSubmit($event)"
                             (accept)="accept($event)">
    </val-failed-geocode-grid>
  </div>

  <p-dialog header="Edit Location" [(visible)]="showDialog" [modal]="true" width="700" [responsive]="true" appendTo="body" (onHide)="onDialogHide()">
    <val-edit-locations [oldData]="selectedRowData" [displayData]="displayData" (submitSite)="manuallyGeocode($event, selectedListType)" (closeDialog)="onDialogHide()"></val-edit-locations>
  </p-dialog>
</div>
